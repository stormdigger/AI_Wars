<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squad Chat + Ludo</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1e1e2e; color: #fff; display: flex; gap: 20px; justify-content: center; padding: 20px; }
        
        /* CHAT STYLES */
        .chat-container { width: 350px; background: #313244; border-radius: 12px; display: flex; flex-direction: column; height: 600px; }
        .chat-header { padding: 15px; background: #181825; text-align: center; border-bottom: 2px solid #cba6f7; }
        .chat-box { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; }
        .message { padding: 8px 12px; background: #45475a; border-radius: 8px; font-size: 0.9em; }
        .input-area { padding: 10px; background: #181825; display: flex; gap: 5px; }
        input { flex: 1; padding: 8px; border-radius: 4px; border: none; background: #1e1e2e; color: white; }
        
        /* LUDO STYLES */
        .game-container { width: 600px; background: #313244; border-radius: 12px; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .ludo-board { width: 400px; height: 400px; background: white; display: grid; grid-template-columns: repeat(15, 1fr); grid-template-rows: repeat(15, 1fr); border: 2px solid #000; position: relative; }
        
        .cell { border: 1px solid #ddd; width: 100%; height: 100%; }
        .red-base { background: #ffadad; grid-column: 1/7; grid-row: 1/7; }
        .green-base { background: #9bf6ff; grid-column: 10/16; grid-row: 1/7; }
        .blue-base { background: #a0c4ff; grid-column: 10/16; grid-row: 10/16; }
        .yellow-base { background: #fdffb6; grid-column: 1/7; grid-row: 10/16; }
        
        /* Tokens */
        .token { width: 20px; height: 20px; border-radius: 50%; border: 2px solid black; position: absolute; cursor: pointer; transition: 0.2s; z-index: 10; }
        .token:hover { transform: scale(1.2); }
        .token.red { background: red; }
        .token.green { background: #00ff00; }
        .token.yellow { background: yellow; }
        .token.blue { background: blue; }

        .controls { margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        .btn { padding: 10px 20px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; }
        .red-btn { background: #ffadad; color: black; }
        .green-btn { background: #9bf6ff; color: black; }
        .yellow-btn { background: #fdffb6; color: black; }
        .blue-btn { background: #a0c4ff; color: black; }
        
        #dice-display { font-size: 2em; margin: 10px; font-weight: bold; }
        
        #setup-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1e1e2e; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
    </style>
</head>
<body>

    <div id="setup-screen">
        <h2>Enter Squad</h2>
        <input id="u-name" placeholder="Name" style="margin: 10px; width: 200px; padding: 10px;">
        <input id="r-id" placeholder="Room ID" style="margin: 10px; width: 200px; padding: 10px;">
        <button class="btn" onclick="joinApp()" style="background: #cba6f7;">Start</button>
    </div>

    <div class="game-container">
        <h2>ðŸŽ² Ludo Arena</h2>
        <div id="dice-display">Dice: ðŸŽ²</div>
        <div id="turn-display">Waiting for players...</div>
        
        <div class="ludo-board" id="board">
            <div class="red-base"></div>
            <div class="green-base"></div>
            <div class="yellow-base"></div>
            <div class="blue-base"></div>
            <div style="grid-column: 7/10; grid-row: 7/10; background: #eee;"></div>
            
            </div>

        <div class="controls">
            <button class="btn red-btn" onclick="sit('red')">Sit Red</button>
            <button class="btn green-btn" onclick="sit('green')">Sit Green</button>
            <button class="btn yellow-btn" onclick="sit('yellow')">Sit Yellow</button>
            <button class="btn blue-btn" onclick="sit('blue')">Sit Blue</button>
            <button class="btn" style="background: white;" onclick="rollDice()">ðŸŽ² ROLL</button>
        </div>
    </div>

    <div class="chat-container">
        <div class="chat-header">Chat</div>
        <div class="chat-box" id="chat-box"></div>
        <div class="input-area">
            <input id="msg-in" placeholder="Type..." onkeypress="if(event.key==='Enter') sendChat()">
            <button class="btn" onclick="sendChat()" style="background:#cba6f7;">Send</button>
        </div>
    </div>

<script>
    let ws, user, room;
    // Map simplified path index (0-51) to Grid Coords (Approximate for visual simplicity)
    // In a real app, you'd map every single cell. Here we map corners to show movement.
    const pathMap = {
        0: {top: '40%', left: '6.6%'}, 13: {top: '6.6%', left: '53%'}, 
        26: {top: '53%', left: '93%'}, 39: {top: '93%', left: '40%'}
    };
    // Base positions
    const basePos = {
        'red': {top: '10%', left: '10%'}, 'green': {top: '10%', left: '80%'},
        'yellow': {top: '80%', left: '10%'}, 'blue': {top: '80%', left: '80%'}
    };

    function joinApp() {
        user = document.getElementById('u-name').value;
        room = document.getElementById('r-id').value;
        if(!user || !room) return alert("Fill all!");
        document.getElementById('setup-screen').style.display = 'none';
        
        const host = "ai-wars.onrender.com"; // CHANGE TO YOUR RENDER URL
        // const host = "localhost:8000"; // UNCOMMENT FOR LOCAL
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        ws = new WebSocket(`${protocol}//${host}/ws/${room}/${user}`);
        
        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            if(data.game_state) updateBoard(data.game_state);
            if(data.message) addMsg(data.sender, data.message);
        };
    }

    function sit(color) {
        ws.send(JSON.stringify({ type: "game", action: "join", color: color }));
    }

    function rollDice() {
        ws.send(JSON.stringify({ type: "game", action: "roll" }));
    }

    function movePiece(idx) {
        ws.send(JSON.stringify({ type: "game", action: "move", piece_index: idx }));
    }

    function updateBoard(state) {
        document.getElementById('dice-display').innerText = `Dice: ${state.dice}`;
        document.getElementById('turn-display').innerText = `Turn: ${state.turn.toUpperCase()}`;
        
        // Remove old tokens
        document.querySelectorAll('.token').forEach(e => e.remove());
        
        // Render new tokens
        for (const [color, pieces] of Object.entries(state.pieces)) {
            pieces.forEach((pos, idx) => {
                const el = document.createElement('div');
                el.className = `token ${color}`;
                el.onclick = () => movePiece(idx);
                
                if (pos === -1) {
                    // Base position (stacked slightly)
                    el.style.top = `calc(${basePos[color].top} + ${idx*5}px)`;
                    el.style.left = `calc(${basePos[color].left} + ${idx*5}px)`;
                } else {
                    // Very simple path mapping for demo purposes
                    // In full version, map 0-51 to specific X/Y%
                    // This moves them roughly around the corners
                    if(pos < 13) { el.style.top = '40%'; el.style.left = `${(pos+1)*6}%`; }
                    else if(pos < 26) { el.style.top = `${(pos-13+1)*6}%`; el.style.left = '53%'; }
                    else if(pos < 39) { el.style.top = '53%'; el.style.left = `${100-(pos-26+1)*6}%`; }
                    else { el.style.top = `${100-(pos-39+1)*6}%`; el.style.left = '40%'; }
                }
                document.getElementById('board').appendChild(el);
            });
        }
    }

    function sendChat() {
        const txt = document.getElementById('msg-in').value;
        if(txt) ws.send(JSON.stringify({ type: "chat", message: txt }));
        document.getElementById('msg-in').value = "";
    }

    function addMsg(sender, msg) {
        const div = document.createElement('div');
        div.className = "message";
        div.innerHTML = `<strong>${sender}:</strong> ${msg}`;
        document.getElementById('chat-box').appendChild(div);
        document.getElementById('chat-box').scrollTop = 9999;
    }
</script>
</body>
</html>